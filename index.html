<!DOCTYPE html>
<html lang="en" id="html-root">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>Mero App</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root {
      --mero-blue: #2563eb;
      --mero-blue-light: #dbeafe;
      --mero-blue-dark: #1d4ed8;
      --surface: #ffffff;
      --on-surface: #1e293b;
      --surface-container: #f8fafc;
      --outline: #cbd5e1;
      --shadow: rgba(0,0,0,0.08);
    }

    [data-theme="dark"] {
      --mero-blue: #60a5fa;
      --mero-blue-light: #1e293b;
      --mero-blue-dark: #93c5fd;
      --surface: #0f172a;
      --on-surface: #f1f5f9;
      --surface-container: #1e293b;
      --outline: #475569;
      --shadow: rgba(0,0,0,0.25);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background-color: var(--surface-container);
      color: var(--on-surface);
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
      padding-bottom: 20px;
    }

    /* ===== LOGIN MODAL ===== */
    #login-modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .login-card {
      background: var(--surface);
      border-radius: 20px;
      padding: 32px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .login-card h2 {
      text-align: center;
      margin-bottom: 24px;
      color: var(--mero-blue-dark);
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-control {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--outline);
      border-radius: 12px;
      background: var(--surface-container);
      color: var(--on-surface);
    }

    .btn-login {
      width: 100%;
      padding: 12px;
      background: var(--mero-blue);
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      margin-top: 8px;
      cursor: pointer;
    }

    .btn-google {
      background: #4285F4;
      margin-top: 12px;
    }

    .divider {
      text-align: center;
      margin: 20px 0;
      color: var(--outline);
      position: relative;
    }

    .divider::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 1px;
      background: var(--outline);
      z-index: 0;
    }

    .divider span {
      background: var(--surface);
      padding: 0 12px;
      position: relative;
      z-index: 1;
    }

    /* ===== APP UI ===== */
    .app-bar {
      background: var(--mero-blue);
      color: white;
      padding: 24px 16px 16px;
      border-radius: 0 0 28px 28px;
      margin: 0 16px 24px;
      box-shadow: 0 4px 12px var(--shadow);
      position: relative;
      z-index: 10;
    }

    .avatar {
      width: 56px;
      height: 56px;
      background: white;
      color: var(--mero-blue);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.4rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .greeting h1 {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .search-box {
      background: rgba(255,255,255,0.2);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 8px 16px;
      margin-top: 16px;
    }

    .search-box input {
      background: transparent;
      border: none;
      color: white;
      width: 100%;
      font-size: 1rem;
      outline: none;
    }

    .section-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--mero-blue-dark);
      margin: 24px 16px 12px;
      padding-left: 4px;
    }

    .app-icon {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 72px;
      padding: 12px 0 6px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .icon-container {
      width: 60px;
      height: 60px;
      background: var(--surface);
      border-radius: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 6px;
      box-shadow: 0 2px 8px var(--shadow);
    }

    .icon-container i {
      font-size: 24px;
      color: var(--mero-blue);
    }

    .app-label {
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--on-surface);
      text-align: center;
      line-height: 1.3;
    }

    .page-container {
      display: none;
      padding: 20px 16px;
      background: var(--surface);
      min-height: calc(100vh - 60px);
      border-radius: 24px 24px 0 0;
      box-shadow: 0 -4px 20px var(--shadow);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 20;
      overflow-y: auto;
    }

    .page-header {
      display: flex;
      align-items: center;
      margin-bottom: 24px;
      padding: 0 8px;
    }

    .btn-back {
      background: transparent;
      border: none;
      color: var(--mero-blue);
      font-size: 1.4rem;
      margin-right: 12px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .page-title {
      font-size: 1.6rem;
      font-weight: 700;
      color: var(--mero-blue-dark);
    }

    .widget-container {
      background: var(--surface);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 4px 12px var(--shadow);
      margin-bottom: 16px;
    }

    .attribution {
      display: block;
      text-align: left;
      font-size: 0.85rem;
      color: var(--outline);
      margin-top: 12px;
    }

    .attribution a {
      color: var(--mero-blue);
      text-decoration: none;
      font-weight: 600;
    }

    .setting-item {
      background: var(--surface);
      border-radius: 16px;
      padding: 18px;
      margin: 16px;
      box-shadow: 0 2px 8px var(--shadow);
    }

    .setting-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 52px;
      height: 26px;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #cbd5e1;
      transition: .4s;
      border-radius: 26px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 4px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    input:checked + .slider {
      background-color: var(--mero-blue);
    }

    input:checked + .slider:before {
      transform: translateX(24px);
    }

    .manage-icons {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
    }

    .manage-icon {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 64px;
      cursor: pointer;
    }

    .manage-icon .icon-container {
      width: 52px;
      height: 52px;
      border-radius: 16px;
    }

    .manage-icon .app-label {
      font-size: 0.8rem;
    }
  </style>
</head>
<body>

<!-- ========== LOGIN MODAL ========== -->
<div id="login-modal">
  <div class="login-card">
    <h2>Welcome to Mero App</h2>
    <div class="form-group">
      <input type="email" id="email" class="form-control" placeholder="Email" required>
    </div>
    <div class="form-group">
      <input type="password" id="password" class="form-control" placeholder="Password" required>
    </div>
    <button class="btn-login" id="login-btn">Sign In</button>
    <button class="btn-login btn-google" id="google-btn">Sign in with Google</button>
    <div class="divider"><span>or</span></div>
    <button class="btn-login" style="background:#64748b;" id="signup-btn">Create Account</button>
  </div>
</div>

<!-- ========== HOME PAGE ========== -->
<div id="home-page" style="display:none;">
  <div class="app-bar">
    <div class="user-info">
      <div class="avatar" id="user-avatar">U</div>
      <div class="greeting">
        <h1>Good Morning!</h1>
        <p id="user-email">user@example.com</p>
      </div>
    </div>
    <div class="search-box">
      <input type="text" placeholder="Search apps...">
    </div>
  </div>

  <h2 class="section-title">Favorite</h2>
  <div id="favorite-grid" class="container">
    <div class="row row-cols-4 g-3"></div>
  </div>

  <h2 class="section-title">Quick Access</h2>
  <div id="quick-access-grid" class="container">
    <div class="row row-cols-4 g-3"></div>
  </div>
</div>

<!-- ========== PAGE 1: Gold & Silver ========== -->
<div id="page-1" class="page-container">
  <div class="page-header">
    <button class="btn-back"><i class="fas fa-arrow-left"></i></button>
    <h2 class="page-title">Gold & Silver Price</h2>
  </div>
  <div class="widget-container">
    <iframe src="https://www.ashesh.com.np/gold/widget.php?api=850024q131&header_color=0077e5" frameborder="0" scrolling="no" style="border:none; width:100%; height:265px;"></iframe>
  </div>
  <span class="attribution">© <a href="https://www.ashesh.com.np/gold/" target="_blank">Gold Price Nepal</a></span>
</div>

<!-- ========== PAGE 6: Currency ========== -->
<div id="page-6" class="page-container">
  <div class="page-header">
    <button class="btn-back"><i class="fas fa-arrow-left"></i></button>
    <h2 class="page-title">Currency Converter</h2>
  </div>
  <div class="widget-container">
    <iframe src="https://www.ashesh.com.np/forex/widget2.php?api=800129q041&header_color=38b45e&background_color=faf8ee&header_title=Nepal%20Exchange%20Rates" frameborder="0" scrolling="no" style="border:none; width:100%; height:383px;"></iframe>
  </div>
  <span class="attribution">© <a href="https://www.ashesh.com.np/forex/" target="_blank">Foreign Exchange Rates</a></span>
</div>

<!-- ========== OTHER PAGES (2–5, 7–15, 17–20) ========== -->
<script>
  const placeholderPages = [
    { id: 2, name: "Date Converter", icon: "fas fa-calendar-alt" },
    { id: 3, name: "My Notes", icon: "fas fa-sticky-note" },
    { id: 4, name: "Expenditure", icon: "fas fa-chart-line" },
    { id: 5, name: "Weather", icon: "fas fa-cloud-sun" },
    { id: 7, name: "Calculator", icon: "fas fa-calculator" },
    { id: 8, name: "To-Do List", icon: "fas fa-tasks" },
    { id: 9, name: "Reminders", icon: "fas fa-bell" },
    { id:10, name: "Health", icon: "fas fa-heartbeat" },
    { id:11, name: "Expense Report", icon: "fas fa-file-invoice" },
    { id:12, name: "Backup", icon: "fas fa-save" },
    { id:13, name: "SMS", icon: "fas fa-envelope" },
    { id:14, name: "Call Log", icon: "fas fa-phone" },
    { id:15, name: "Files", icon: "fas fa-folder" },
    { id:17, name: "Privacy", icon: "fas fa-shield-alt" },
    { id:18, name: "Support", icon: "fas fa-headset" },
    { id:19, name: "About", icon: "fas fa-info-circle" },
    { id:20, name: "Feedback", icon: "fas fa-comment-dots" }
  ];

  placeholderPages.forEach(page => {
    const div = document.createElement('div');
    div.id = `page-${page.id}`;
    div.className = 'page-container';
    div.innerHTML = `
      <div class="page-header">
        <button class="btn-back"><i class="fas fa-arrow-left"></i></button>
        <h2 class="page-title">${page.name}</h2>
      </div>
      <div style="text-align:center; padding:40px 20px;">
        <i class="${page.icon} fa-4x" style="color:var(--outline); margin-bottom:24px;"></i>
        <h3>${page.name}</h3>
        <p style="color:var(--outline); margin-top:12px;">Coming soon!</p>
        <button class="btn-back" style="margin-top:24px; background:var(--mero-blue-light); width:100px; height:40px; border-radius:20px;">
          <i class="fas fa-arrow-left"></i> Back
        </button>
      </div>
    `;
    document.body.appendChild(div);
  });
</script>

<!-- ========== SETTINGS PAGE (16) ========== -->
<div id="page-16" class="page-container">
  <div class="page-header">
    <button class="btn-back"><i class="fas fa-arrow-left"></i></button>
    <h2 class="page-title">Settings</h2>
  </div>

  <div class="setting-item">
    <div class="setting-label">Account</div>
    <button class="btn-login" style="background:#ef4444; margin-top:12px;" id="logout-btn">Sign Out</button>
  </div>

  <div class="setting-item">
    <div class="setting-label">Appearance</div>
    <div class="setting-row">
      <span id="theme-label">Light Mode</span>
      <label class="toggle-switch">
        <input type="checkbox" id="theme-toggle">
        <span class="slider"></span>
      </label>
    </div>
  </div>

  <div class="setting-item">
    <div class="setting-label">Favorite Apps</div>
    <p style="margin:12px 0;color:var(--outline);">Tap to add or remove from Favorites</p>
    <div class="manage-section">
      <div class="manage-title">Your Favorites</div>
      <div class="manage-icons" id="settings-fav-list"></div>
    </div>
    <div class="manage-section">
      <div class="manage-title">Other Apps</div>
      <div class="manage-icons" id="settings-quick-list"></div>
    </div>
  </div>
</div>

<!-- ========== FIREBASE SDKs ========== -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>
  // ✅ YOUR FIREBASE CONFIG
  const firebaseConfig = {
    apiKey: "AIzaSyCmRtWiJ83YUE28EmXABNcsv2cZMb8Mguo",
    authDomain: "meroapp-61711.firebaseapp.com",
    projectId: "meroapp-61711",
    storageBucket: "meroapp-61711.firebasestorage.app",
    messagingSenderId: "729280641074",
    appId: "1:729280641074:web:daf11ed246eb192f61a42b"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // DOM
  const loginModal = document.getElementById('login-modal');
  const homePage = document.getElementById('home-page');
  const loginBtn = document.getElementById('login-btn');
  const signupBtn = document.getElementById('signup-btn');
  const googleBtn = document.getElementById('google-btn');
  const logoutBtn = document.getElementById('logout-btn');

  // App Data
  const ALL_APPS = [
    { id: 1, name: "Gold & Silver", icon: "fas fa-coins" },
    { id: 2, name: "Date Converter", icon: "fas fa-calendar-alt" },
    { id: 3, name: "My Notes", icon: "fas fa-sticky-note" },
    { id: 4, name: "Expenditure", icon: "fas fa-chart-line" },
    { id: 5, name: "Weather", icon: "fas fa-cloud-sun" },
    { id: 6, name: "Currency", icon: "fas fa-exchange-alt" },
    { id: 7, name: "Calculator", icon: "fas fa-calculator" },
    { id: 8, name: "To-Do List", icon: "fas fa-tasks" },
    { id: 9, name: "Reminders", icon: "fas fa-bell" },
    { id:10, name: "Health", icon: "fas fa-heartbeat" },
    { id:11, name: "Expense Report", icon: "fas fa-file-invoice" },
    { id:12, name: "Backup", icon: "fas fa-save" },
    { id:13, name: "SMS", icon: "fas fa-envelope" },
    { id:14, name: "Call Log", icon: "fas fa-phone" },
    { id:15, name: "Files", icon: "fas fa-folder" },
    { id:16, name: "Settings", icon: "fas fa-cog" },
    { id:17, name: "Privacy", icon: "fas fa-shield-alt" },
    { id:18, name: "Support", icon: "fas fa-headset" },
    { id:19, name: "About", icon: "fas fa-info-circle" },
    { id:20, name: "Feedback", icon: "fas fa-comment-dots" }
  ];

  // Global state
  let currentTheme = 'light';
  let currentFavorites = [1, 2, 3, 4];

  // Firestore helpers
  function getSettingsRef() {
    const user = auth.currentUser;
    return user ? db.collection('userSettings').doc(user.uid) : null;
  }

  async function saveSettings(theme, favorites) {
    const ref = getSettingsRef();
    if (ref) {
      await ref.set({ theme, favorites }, { merge: true });
    }
  }

  async function loadSettings() {
    const ref = getSettingsRef();
    if (ref) {
      const doc = await ref.get();
      if (doc.exists) {
        const data = doc.data();
        return {
          theme: data.theme || 'light',
          favorites: data.favorites || [1, 2, 3, 4]
        };
      }
    }
    return { theme: 'light', favorites: [1, 2, 3, 4] };
  }

  // Auth State Listener
  auth.onAuthStateChanged(async (user) => {
    if (user) {
      // Load user-specific settings from Firestore
      const settings = await loadSettings();
      currentTheme = settings.theme;
      currentFavorites = settings.favorites;

      // Apply theme
      document.documentElement.setAttribute('data-theme', currentTheme);
      document.getElementById('theme-toggle').checked = (currentTheme === 'dark');
      document.getElementById('theme-label').textContent = 
        currentTheme === 'dark' ? 'Dark Mode' : 'Light Mode';

      // Update UI
      loginModal.style.display = 'none';
      homePage.style.display = 'block';
      document.getElementById('user-email').textContent = user.email;
      const initials = user.email.split('@')[0].substring(0,2).toUpperCase();
      document.getElementById('user-avatar').textContent = initials;

      renderHomeGrids();
      renderManageLists();
    } else {
      loginModal.style.display = 'flex';
      homePage.style.display = 'none';
    }
  });

  // Login
  loginBtn.addEventListener('click', () => {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    auth.signInWithEmailAndPassword(email, password)
      .catch(err => alert('Login failed: ' + err.message));
  });

  // Sign Up
  signupBtn.addEventListener('click', () => {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    auth.createUserWithEmailAndPassword(email, password)
      .catch(err => alert('Sign up failed: ' + err.message));
  });

  // Google Sign-In
  googleBtn.addEventListener('click', () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider)
      .catch(err => alert('Google sign-in failed: ' + err.message));
  });

  // Logout
  logoutBtn.addEventListener('click', () => {
    auth.signOut();
  });

  // UI Functions
  function renderHomeGrids() {
    const favGrid = document.querySelector('#favorite-grid .row');
    const quickGrid = document.querySelector('#quick-access-grid .row');
    favGrid.innerHTML = ''; quickGrid.innerHTML = '';
    currentFavorites.forEach(id => {
      const app = ALL_APPS.find(a => a.id === id);
      if (app && app.id !== 16) favGrid.innerHTML += createAppIcon(app);
    });
    ALL_APPS.filter(app => !currentFavorites.includes(app.id))
      .forEach(app => quickGrid.innerHTML += createAppIcon(app));
  }

  function createAppIcon(app) {
    return `<div class="col"><div class="app-icon" data-page="${app.id}"><div class="icon-container"><i class="${app.icon}"></i></div><div class="app-label">${app.name}</div></div></div>`;
  }

  function renderManageLists() {
    const favList = document.getElementById('settings-fav-list');
    const quickList = document.getElementById('settings-quick-list');
    favList.innerHTML = ''; quickList.innerHTML = '';
    currentFavorites.filter(id => id !== 16).forEach(id => {
      const app = ALL_APPS.find(a => a.id === id);
      if (app) favList.innerHTML += createManageIcon(app);
    });
    ALL_APPS.filter(app => !currentFavorites.includes(app.id) && app.id !== 16)
      .forEach(app => quickList.innerHTML += createManageIcon(app));
  }

  function createManageIcon(app) {
    return `<div class="manage-icon" data-id="${app.id}"><div class="icon-container"><i class="${app.icon}"></i></div><div class="app-label">${app.name}</div></div>`;
  }

  function toggleFavorite(id) {
    if (id === 16) return;
    if (currentFavorites.includes(id)) {
      currentFavorites = currentFavorites.filter(x => x !== id);
    } else if (currentFavorites.length < 8) {
      currentFavorites.push(id);
    }
    saveSettings(currentTheme, currentFavorites); // Sync to cloud
    renderHomeGrids();
    renderManageLists();
  }

  // Theme Toggle
  document.getElementById('theme-toggle').addEventListener('change', (e) => {
    currentTheme = e.target.checked ? 'dark' : 'light';
    document.documentElement.setAttribute('data-theme', currentTheme);
    document.getElementById('theme-label').textContent = 
      currentTheme === 'dark' ? 'Dark Mode' : 'Light Mode';
    saveSettings(currentTheme, currentFavorites); // Sync to cloud
  });

  // Navigation
  document.addEventListener('click', (e) => {
    const appIcon = e.target.closest('.app-icon');
    if (appIcon) return showPage(appIcon.getAttribute('data-page'));
    const manageIcon = e.target.closest('.manage-icon');
    if (manageIcon) return toggleFavorite(parseInt(manageIcon.getAttribute('data-id')));
    if (e.target.closest('.btn-back')) return showHome();
  });

  function showPage(num) {
    homePage.style.display = 'none';
    document.getElementById(`page-${num}`).style.display = 'block';
  }

  function showHome() {
    homePage.style.display = 'block';
    for (let i = 1; i <= 20; i++) {
      const el = document.getElementById(`page-${i}`);
      if (el) el.style.display = 'none';
    }
  }
</script>

</body>
</html>
